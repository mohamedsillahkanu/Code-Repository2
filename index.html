<!DOCTYPE html>        
<html lang="en">
<head>
    <meta charset="UTF-8">   
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Repository</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0066cc 0%, #004499 50%, #ffffff 100%);
            min-height: 100vh;
            color: #333;
            padding: 0;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #0066cc;
            padding: 25px 0;
            margin-bottom: 40px;
            box-shadow: 0 2px 10px rgba(0, 102, 204, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 30px;
        }

        .logo-container {
            width: 140px;
            height: 90px;
            border: 2px solid #0066cc;
            border-radius: 12px;
            overflow: hidden;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.15);
            transition: transform 0.3s ease;
        }

        .logo-container:hover {
            transform: translateY(-3px);
        }

        .logo-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 8px;
        }

        .title-section {
            text-align: center;
        }

        .main-title {
            font-size: 3em;
            color: #0066cc;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 102, 204, 0.3);
        }

        .subtitle {
            font-size: 1.4em;
            color: #004499;
            font-weight: 400;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 15px 40px rgba(0, 102, 204, 0.2);
            border: 1px solid rgba(0, 102, 204, 0.2);
        }

        /* Pyodide Status Banner */
        .pyodide-status {
            background: linear-gradient(135deg, #1e293b, #334155);
            color: #94a3b8;
            padding: 12px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95em;
            border: 1px solid rgba(59, 130, 246, 0.3);
            transition: all 0.5s ease;
        }

        .pyodide-status.ready {
            background: linear-gradient(135deg, #064e3b, #065f46);
            color: #6ee7b7;
            border-color: rgba(16, 185, 129, 0.4);
        }

        .pyodide-status.error {
            background: linear-gradient(135deg, #7f1d1d, #991b1b);
            color: #fca5a5;
            border-color: rgba(239, 68, 68, 0.4);
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #f59e0b;
            animation: pulse-dot 1.5s ease-in-out infinite;
        }

        .pyodide-status.ready .status-dot {
            background: #10b981;
            animation: none;
        }

        .pyodide-status.error .status-dot {
            background: #ef4444;
            animation: none;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }

        /* Tab Toggle Button */
        .tab-toggle-btn {
            background: linear-gradient(135deg, #004499, #0066cc);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 68, 153, 0.3);
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            width: 250px;
        }

        .tab-toggle-btn:hover {
            background: linear-gradient(135deg, #0066cc, #004499);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 102, 204, 0.4);
        }

        .tab-toggle-btn .arrow {
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .tab-toggle-btn.collapsed .arrow {
            transform: rotate(-90deg);
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            flex-wrap: wrap;
            border-bottom: 3px solid #0066cc;
            margin-bottom: 40px;
            gap: 5px;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: all 0.5s ease;
        }

        .tab-navigation.expanded {
            max-height: 200px;
            opacity: 1;
            margin-bottom: 40px;
        }

        .tab-button {
            background: rgba(0, 102, 204, 0.1);
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #004499;
            border-radius: 10px 10px 0 0;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            margin-bottom: -3px;
            position: relative;
        }

        .tab-button:hover {
            background: rgba(0, 102, 204, 0.2);
            color: #0066cc;
        }

        .tab-button.active {
            background: #0066cc;
            color: white;
            border-bottom: 3px solid #0066cc;
            transform: translateY(3px);
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Content Sections */
        .section-header {
            color: #0066cc;
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
            padding: 20px;
            background: rgba(0, 102, 204, 0.1);
            border-radius: 15px;
            border-left: 5px solid #0066cc;
        }

        /* Hierarchical Section Styling */
        .collapsible-section {
            margin-bottom: 30px;
            border: 2px solid rgba(0, 102, 204, 0.2);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.1);
        }

        .section-toggle.level-2 {
            background: linear-gradient(135deg, #0066cc, #004499);
            color: white;
            border: none;
            padding: 20px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 1.3em;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-toggle.level-2:hover {
            background: linear-gradient(135deg, #004499, #0066cc);
        }

        .subsection {
            border-left: 4px solid #3b82f6;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
        }

        .section-toggle.level-3 {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            border: none;
            padding: 15px 20px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-toggle.level-3:hover {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
        }

        .sub-subsection {
            border-left: 4px solid #10b981;
            margin: 10px 0 10px 20px;
            border-radius: 0 8px 8px 0;
            box-shadow: 0 1px 6px rgba(16, 185, 129, 0.1);
        }

        .section-toggle.level-4 {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 15px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-toggle.level-4:hover {
            background: linear-gradient(135deg, #059669, #10b981);
        }

        .section-toggle::after {
            content: '‚ñº';
            font-size: 1.2em;
            transition: transform 0.3s ease;
        }

        .section-toggle.collapsed::after {
            transform: rotate(-90deg);
        }

        .section-content {
            background: rgba(255, 255, 255, 0.95);
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
            padding: 0;
        }

        .section-content.expanded {
            max-height: none;
            padding: 20px;
        }

        .section-content.level-3.expanded,
        .section-content.level-4.expanded {
            padding: 15px;
        }

        .content-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            border-left: 4px solid #0066cc;
        }

        .content-text.level-3 {
            border-left-color: #3b82f6;
            padding: 15px;
            margin-bottom: 15px;
        }

        .content-text.level-4 {
            border-left-color: #10b981;
            padding: 12px;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .content-text img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.2);
            margin: 15px 0;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .step-description {
            background: rgba(0, 102, 204, 0.05);
            border-left: 4px solid #0066cc;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 0 10px 10px 0;
            color: #004499;
            font-size: 1em;
            line-height: 1.5;
            font-weight: 500;
        }

        /* Enhanced Table Styling */
        .markdown-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 102, 204, 0.15), 0 4px 15px rgba(0, 102, 204, 0.1);
            border: 2px solid rgba(0, 102, 204, 0.1);
            position: relative;
            font-size: 0.95em;
        }

        .markdown-table::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #0066cc, #3b82f6, #10b981, #f59e0b, #ef4444);
            background-size: 400% 100%;
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .markdown-table thead {
            background: linear-gradient(135deg, #0066cc 0%, #004499 50%, #003366 100%);
        }

        .markdown-table th {
            padding: 18px 16px;
            text-align: left;
            font-weight: 700;
            font-size: 1.1em;
            color: white;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .markdown-table th:last-child { border-right: none; }

        .markdown-table tbody tr:nth-child(odd) {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }

        .markdown-table tbody tr:nth-child(even) {
            background: linear-gradient(135deg, rgba(0, 102, 204, 0.03) 0%, rgba(59, 130, 246, 0.05) 100%);
        }

        .markdown-table tbody tr:hover {
            background: linear-gradient(135deg, rgba(0, 102, 204, 0.08) 0%, rgba(59, 130, 246, 0.12) 100%);
            transform: translateX(5px);
        }

        .markdown-table td {
            padding: 14px 16px;
            border-bottom: 1px solid rgba(0, 102, 204, 0.08);
            border-right: 1px solid rgba(0, 102, 204, 0.08);
            vertical-align: top;
        }

        .markdown-table td:last-child { border-right: none; }
        .markdown-table td:first-child { font-weight: 600; color: #004499; }

        .table-container {
            overflow-x: auto;
            margin: 25px 0;
            border-radius: 15px;
            padding: 5px;
        }

        /* Code Section Styling */
        .code-section {
            margin: 30px 0;
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.1);
            background: rgba(255, 255, 255, 0.95);
        }

        .code-header {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .code-title {
            font-weight: 600;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .code-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .copy-btn, .run-btn, .clear-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .copy-btn:hover, .clear-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .run-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: rgba(16, 185, 129, 0.5);
            font-weight: 700;
            padding: 8px 20px;
        }

        .run-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .run-btn.running {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            pointer-events: none;
        }

        .run-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .clear-btn {
            background: rgba(239, 68, 68, 0.3);
            border-color: rgba(239, 68, 68, 0.4);
        }

        .clear-btn:hover {
            background: rgba(239, 68, 68, 0.5);
        }

        .copy-btn.copied {
            background: #10b981;
            border-color: #10b981;
        }

        .code-container {
            background: #1e293b;
            padding: 0;
            position: relative;
            overflow-x: auto;
        }

        .code-content {
            padding: 25px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #e2e8f0;
            white-space: pre;
            overflow-x: auto;
        }

        /* Code Editor (editable) */
        .code-editor {
            padding: 25px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #e2e8f0;
            background: #1e293b;
            white-space: pre;
            overflow-x: auto;
            outline: none;
            min-height: 60px;
            border: none;
            width: 100%;
            resize: vertical;
            tab-size: 4;
        }

        .code-editor:focus {
            box-shadow: inset 0 0 0 2px rgba(59, 130, 246, 0.5);
        }

        /* Output Section */
        .output-section {
            border-top: 2px solid rgba(16, 185, 129, 0.3);
            background: #0f172a;
            position: relative;
        }

        .output-header {
            background: linear-gradient(135deg, #064e3b, #065f46);
            color: #6ee7b7;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 0.95em;
        }

        .output-content {
            padding: 20px 25px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #a7f3d0;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
            min-height: 40px;
        }

        .output-content.has-error {
            color: #fca5a5;
        }

        .output-content .output-stdout {
            color: #a7f3d0;
        }

        .output-content .output-stderr {
            color: #fca5a5;
        }

        .output-content .output-result {
            color: #93c5fd;
            border-top: 1px dashed rgba(147, 197, 253, 0.3);
            padding-top: 8px;
            margin-top: 8px;
        }

        /* Output image styling */
        .output-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 10px 0;
            background: white;
            padding: 8px;
        }

        .output-spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(167, 243, 208, 0.3);
            border-top-color: #a7f3d0;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Loading indicator */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #0066cc;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #0066cc;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-title { font-size: 2.2em; }
            .subtitle { font-size: 1.2em; }
            .logo-section { justify-content: center; }
            .logo-container { width: 120px; height: 80px; }
            .dashboard-container { padding: 30px; }
            .tab-navigation { flex-direction: column; }
            .tab-button {
                border-radius: 10px;
                margin-bottom: 5px;
                padding: 12px 20px;
                font-size: 0.9em;
            }
            .tab-button.active { transform: none; }
            .tab-toggle-btn { width: 200px; padding: 12px 20px; font-size: 1em; }
            .section-toggle { font-size: 1.1em !important; padding: 15px !important; }
            .sub-subsection { margin-left: 10px; }
            .code-actions { flex-wrap: wrap; }
            .code-header { flex-direction: column; gap: 10px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-container">
                    <img src="NMCP.png" alt="NMCP Logo" class="logo-image">
                </div>
                <div class="logo-container">
                    <img src="WHO.png" alt="WHO Logo" class="logo-image">
                </div>
                <div class="logo-container">
                    <img src="CHAI2.png" alt="CHAI Logo" class="logo-image">
                </div>
                <div class="logo-container">
                    <img src="NU logo.png" alt="NU Logo" class="logo-image">
                </div>
                <div class="logo-container">
                    <img src="ICF-SL.jpg" alt="ICF-SL Logo" class="logo-image">
                </div>
            </div>
            <div class="title-section">
                <h1 class="main-title">MTR Code Repository</h1>
                <h2 class="subtitle">2021-2024</h2>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Pyodide Status -->
        <div class="pyodide-status" id="pyodideStatus">
            <div class="status-dot"></div>
            <span id="pyodideStatusText">üêç Loading Python runtime (Pyodide)... This may take a moment on first load.</span>
        </div>

        <!-- Tab Toggle Button -->
        <button class="tab-toggle-btn collapsed" onclick="toggleTabs()" id="tabToggleBtn">
            <span>üìÇ</span>
            <span>Show Navigation Menu</span>
            <span class="arrow">‚ñº</span>
        </button>

        <!-- Dynamic Tab Navigation -->
        <div class="tab-navigation" id="tabNavigation"></div>

        <!-- Tab Contents -->
        <div id="overview" class="tab-content active">
            <div class="section-header">Code Repository</div>
            
            <div class="collapsible-section">
                <button class="section-toggle level-2 collapsed" onclick="toggleSection(this)">
                    üíª Code Repository Overview
                </button>
                <div class="section-content">
                    <div class="content-text">
                        <strong>Malaria Data Analysis Code Repository</strong><br>
                        This system provides a comprehensive collection of Python scripts and analysis tools designed specifically for the National Malaria Control Programme (NMCP) in Sierra Leone. 
                        The code repository contains standardized functions for processing malaria surveillance data, calculating key indicators, and generating analytical reports that support evidence-based decision making.
                        <br><br>
                        <strong>üêç Interactive Python Execution:</strong><br>
                        All code blocks in this repository are <em>executable</em>. Click the <strong style="color: #10b981;">‚ñ∂ Run</strong> button on any code block to execute it directly in your browser using Pyodide. 
                        You can also <strong>edit code</strong> before running it. Available libraries include <code>pandas</code>, <code>numpy</code>, <code>matplotlib</code>, and more.
                    </div>
                </div>
            </div>

            <!-- Demo Code Block -->
            <div class="collapsible-section">
                <button class="section-toggle level-2 collapsed" onclick="toggleSection(this)">
                    üß™ Try It ‚Äî Interactive Demo
                </button>
                <div class="section-content">
                    <div class="content-text">
                        Try running this sample code to see the interactive execution in action:
                    </div>
                    <div class="code-section">
                        <div class="code-header">
                            <div class="code-title"><span>üíª</span> PYTHON ‚Äî Interactive Demo</div>
                            <div class="code-actions">
                                <button class="copy-btn" onclick="copyCode('demo-code')"><span>üìã</span> Copy</button>
                                <button class="run-btn" onclick="runCode('demo-code', 'demo-output')"><span>‚ñ∂</span> Run</button>
                            </div>
                        </div>
                        <div class="code-container">
                            <textarea class="code-editor" id="demo-code" spellcheck="false">import pandas as pd
import numpy as np

# Sample malaria surveillance data
districts = ['Bo', 'Bombali', 'Bonthe', 'Kailahun', 'Kambia', 
             'Kenema', 'Koinadugu', 'Kono', 'Moyamba', 'Port Loko',
             'Pujehun', 'Tonkolili', 'Western Area Rural', 'Western Area Urban']

np.random.seed(42)
data = {
    'District': districts,
    'Confirmed_Cases': np.random.randint(500, 5000, len(districts)),
    'Tests_Conducted': np.random.randint(2000, 10000, len(districts)),
    'Population': np.random.randint(100000, 500000, len(districts))
}

df = pd.DataFrame(data)
df['TPR'] = (df['Confirmed_Cases'] / df['Tests_Conducted'] * 100).round(1)
df['Incidence_per_1000'] = (df['Confirmed_Cases'] / df['Population'] * 1000).round(1)

print("=" * 70)
print("  MALARIA SURVEILLANCE SUMMARY ‚Äî Sierra Leone (Sample)")
print("=" * 70)
print(df.to_string(index=False))
print("\n--- Summary Statistics ---")
print(f"Total Confirmed Cases: {df['Confirmed_Cases'].sum():,}")
print(f"Average TPR: {df['TPR'].mean():.1f}%")
print(f"Highest Incidence: {df.loc[df['Incidence_per_1000'].idxmax(), 'District']} ({df['Incidence_per_1000'].max()}/1000)")
</textarea>
                        </div>
                        <div class="output-section" id="demo-output-section" style="display:none;">
                            <div class="output-header">
                                <span>üì§ Output</span>
                                <button class="clear-btn" onclick="clearOutput('demo-output')"><span>üóë</span> Clear</button>
                            </div>
                            <div class="output-content" id="demo-output"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Matplotlib Demo -->
            <div class="collapsible-section">
                <button class="section-toggle level-2 collapsed" onclick="toggleSection(this)">
                    üìä Chart Demo ‚Äî Matplotlib in Browser
                </button>
                <div class="section-content">
                    <div class="content-text">
                        Matplotlib charts render as images directly in the output panel:
                    </div>
                    <div class="code-section">
                        <div class="code-header">
                            <div class="code-title"><span>üìä</span> PYTHON ‚Äî Matplotlib Chart</div>
                            <div class="code-actions">
                                <button class="copy-btn" onclick="copyCode('chart-code')"><span>üìã</span> Copy</button>
                                <button class="run-btn" onclick="runCode('chart-code', 'chart-output')"><span>‚ñ∂</span> Run</button>
                            </div>
                        </div>
                        <div class="code-container">
                            <textarea class="code-editor" id="chart-code" spellcheck="false">import matplotlib
matplotlib.use('AGG')
import matplotlib.pyplot as plt
import numpy as np
import io, base64

districts = ['Bo', 'Bombali', 'Kenema', 'Kono', 'Moyamba', 'Port Loko', 'WA Urban']
cases = [3200, 2800, 4100, 1900, 2500, 3700, 4500]
colors = ['#0066cc', '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899']

fig, ax = plt.subplots(figsize=(10, 5))
bars = ax.bar(districts, cases, color=colors, edgecolor='white', linewidth=1.5)
ax.set_title('Confirmed Malaria Cases by District', fontsize=14, fontweight='bold', pad=15)
ax.set_ylabel('Cases')
ax.set_xlabel('District')
ax.spines['top'].set_visible(False)
ax.spines['right'].set_visible(False)
plt.xticks(rotation=30, ha='right')
plt.tight_layout()

# Convert to base64 image
buf = io.BytesIO()
fig.savefig(buf, format='png', dpi=120, bbox_inches='tight')
buf.seek(0)
img_b64 = base64.b64encode(buf.read()).decode()
plt.close(fig)

# Display using special IMG marker
print(f'__IMG__data:image/png;base64,{img_b64}')
print("Chart rendered successfully!")
</textarea>
                        </div>
                        <div class="output-section" id="chart-output-section" style="display:none;">
                            <div class="output-header">
                                <span>üì§ Output</span>
                                <button class="clear-btn" onclick="clearOutput('chart-output')"><span>üóë</span> Clear</button>
                            </div>
                            <div class="output-content" id="chart-output"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="tab2" class="tab-content">
            <div class="section-header">Malaria Analysis Code</div>
            <div class="loading" id="loading-tab2">
                <div class="spinner"></div>
                Loading content...
            </div>
        </div>

        <div id="tab3" class="tab-content">
            <div class="section-header">Data Visualization</div>
            <div class="loading" id="loading-tab3">
                <div class="spinner"></div>
                Loading content...
            </div>
        </div>

        <div id="tab4" class="tab-content">
            <div class="section-header">Reports & Export</div>
            <div class="loading" id="loading-tab4">
                <div class="spinner"></div>
                Loading content...
            </div>
        </div>
    </div>

    <!-- Pyodide CDN -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>

    <script>
        // ============================================================
        // PYODIDE PYTHON RUNTIME
        // ============================================================
        let pyodideReady = false;
        let pyodideInstance = null;
        let pyodideLoading = false;

        async function initPyodide() {
            if (pyodideLoading || pyodideReady) return;
            pyodideLoading = true;

            const statusEl = document.getElementById('pyodideStatus');
            const statusText = document.getElementById('pyodideStatusText');

            try {
                statusText.textContent = 'üêç Loading Python runtime...';
                
                pyodideInstance = await loadPyodide({
                    indexURL: "https://cdn.jsdelivr.net/pyodide/v0.25.1/full/"
                });

                statusText.textContent = 'üì¶ Installing packages (pandas, numpy, matplotlib)...';
                
                await pyodideInstance.loadPackage(['pandas', 'numpy', 'matplotlib']);

                pyodideReady = true;
                statusEl.classList.add('ready');
                statusText.textContent = '‚úÖ Python ready ‚Äî pandas, numpy, matplotlib loaded. Click ‚ñ∂ Run on any code block!';

                // Enable all run buttons
                document.querySelectorAll('.run-btn').forEach(btn => btn.disabled = false);

            } catch (err) {
                console.error('Pyodide init error:', err);
                statusEl.classList.add('error');
                statusText.textContent = `‚ùå Failed to load Python runtime: ${err.message}. Code execution disabled ‚Äî copy/paste still works.`;
            } finally {
                pyodideLoading = false;
            }
        }

        // Run Python code
        async function runCode(codeId, outputId) {
            if (!pyodideReady) {
                alert('Python runtime is still loading. Please wait...');
                return;
            }

            const codeEl = document.getElementById(codeId);
            const outputEl = document.getElementById(outputId);
            const outputSection = document.getElementById(outputId + '-section');
            const runBtn = codeEl.closest('.code-section').querySelector('.run-btn');

            // Get code from textarea
            const code = codeEl.value || codeEl.textContent;

            // Show output section
            outputSection.style.display = 'block';
            outputEl.innerHTML = '<span class="output-spinner"></span> Running...';
            outputEl.classList.remove('has-error');

            // Mark button as running
            if (runBtn) {
                runBtn.classList.add('running');
                runBtn.innerHTML = '<span class="output-spinner"></span> Running...';
            }

            try {
                // Capture stdout/stderr
                pyodideInstance.runPython(`
import sys, io
__stdout_capture = io.StringIO()
__stderr_capture = io.StringIO()
sys.stdout = __stdout_capture
sys.stderr = __stderr_capture
`);

                // Run user code
                let result;
                try {
                    result = await pyodideInstance.runPythonAsync(code);
                } catch (pyErr) {
                    // Get captured stderr
                    const stderr = pyodideInstance.runPython('__stderr_capture.getvalue()');
                    
                    // Reset stdout/stderr
                    pyodideInstance.runPython(`
sys.stdout = sys.__stdout__
sys.stderr = sys.__stderr__
`);
                    
                    outputEl.classList.add('has-error');
                    outputEl.innerHTML = `<div class="output-stderr">${escapeHtml(pyErr.message)}</div>`;
                    return;
                }

                // Get captured output
                const stdout = pyodideInstance.runPython('__stdout_capture.getvalue()');
                const stderr = pyodideInstance.runPython('__stderr_capture.getvalue()');

                // Reset stdout/stderr
                pyodideInstance.runPython(`
sys.stdout = sys.__stdout__
sys.stderr = sys.__stderr__
`);

                // Build output
                let outputHtml = '';

                if (stdout) {
                    // Check for image markers
                    const lines = stdout.split('\n');
                    lines.forEach(line => {
                        if (line.startsWith('__IMG__')) {
                            const src = line.replace('__IMG__', '');
                            outputHtml += `<img src="${src}" alt="Plot output">`;
                        } else {
                            outputHtml += `<div class="output-stdout">${escapeHtml(line)}</div>`;
                        }
                    });
                }

                if (stderr) {
                    outputHtml += `<div class="output-stderr">${escapeHtml(stderr)}</div>`;
                }

                if (result !== undefined && result !== null && String(result) !== 'undefined') {
                    outputHtml += `<div class="output-result">‚Üí ${escapeHtml(String(result))}</div>`;
                }

                if (!outputHtml) {
                    outputHtml = '<div class="output-stdout" style="color: #6b7280; font-style: italic;">Code executed successfully (no output)</div>';
                }

                outputEl.innerHTML = outputHtml;

            } catch (err) {
                outputEl.classList.add('has-error');
                outputEl.innerHTML = `<div class="output-stderr">Error: ${escapeHtml(err.message)}</div>`;
            } finally {
                if (runBtn) {
                    runBtn.classList.remove('running');
                    runBtn.innerHTML = '<span>‚ñ∂</span> Run';
                }
            }
        }

        function clearOutput(outputId) {
            const outputEl = document.getElementById(outputId);
            const outputSection = document.getElementById(outputId + '-section');
            if (outputEl) {
                outputEl.innerHTML = '';
                outputEl.classList.remove('has-error');
            }
            if (outputSection) {
                outputSection.style.display = 'none';
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ============================================================
        // DYNAMIC TAB CONFIGURATION (from your original code)
        // ============================================================
        let TAB_CONFIG = {};
        let dynamicTabs = [];

        async function loadTabConfiguration() {
            try {
                const response = await fetch('tab_config.json');
                if (response.ok) {
                    const config = await response.json();
                    TAB_CONFIG = config.tabs || {};
                    dynamicTabs = config.navigation || [];
                    generateDynamicNavigation();
                    return true;
                }
                throw new Error(`HTTP ${response.status}`);
            } catch (error) {
                console.warn('‚ö†Ô∏è tab_config.json not found, using defaults');
                loadDefaultConfiguration();
                return false;
            }
        }

        function loadDefaultConfiguration() {
            TAB_CONFIG = {
                'tab2': { file: 'malaria_analysis.md', title: 'Malaria Analysis Code' },
                'tab3': { file: 'data_visualization.md', title: 'Data Visualization' },
                'tab4': { file: 'reports_export.md', title: 'Reports & Export' }
            };
            dynamicTabs = [
                { id: 'overview', title: 'Overview', default: true },
                { id: 'tab2', title: 'Malaria Analysis Code' },
                { id: 'tab3', title: 'Data Visualization' },
                { id: 'tab4', title: 'Reports & Export' }
            ];
            generateDynamicNavigation();
        }

        function generateDynamicNavigation() {
            const tabNavigation = document.getElementById('tabNavigation');
            if (!tabNavigation) return;
            tabNavigation.innerHTML = '';
            dynamicTabs.forEach(tab => {
                const button = document.createElement('button');
                button.className = `tab-button ${tab.default ? 'active' : ''}`;
                button.onclick = (event) => openTab(event, tab.id);
                button.textContent = tab.title;
                tabNavigation.appendChild(button);
                if (tab.id !== 'overview' && !document.getElementById(tab.id)) {
                    createTabContainer(tab.id, tab.title);
                }
            });
        }

        function createTabContainer(tabId, title) {
            const dashboardContainer = document.querySelector('.dashboard-container');
            if (!dashboardContainer) return;
            const tabDiv = document.createElement('div');
            tabDiv.id = tabId;
            tabDiv.className = 'tab-content';
            tabDiv.innerHTML = `
                <div class="section-header">${title}</div>
                <div class="loading" id="loading-${tabId}">
                    <div class="spinner"></div>
                    Loading content...
                </div>
            `;
            dashboardContainer.appendChild(tabDiv);
        }

        function openTab(evt, tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
            const targetTab = document.getElementById(tabName);
            if (targetTab) targetTab.classList.add('active');
            if (evt && evt.currentTarget) evt.currentTarget.classList.add('active');
            if (TAB_CONFIG[tabName] && !targetTab.dataset.loaded) loadTabContent(tabName);
            // Auto-collapse nav
            document.getElementById('tabNavigation')?.classList.remove('expanded');
            const toggleBtn = document.getElementById('tabToggleBtn');
            if (toggleBtn) {
                toggleBtn.classList.add('collapsed');
                toggleBtn.innerHTML = '<span>üìÇ</span><span>Show Navigation Menu</span><span class="arrow">‚ñº</span>';
            }
        }

        function toggleTabs() {
            const tabNav = document.getElementById('tabNavigation');
            const toggleBtn = document.getElementById('tabToggleBtn');
            if (!tabNav || !toggleBtn) return;
            if (tabNav.classList.contains('expanded')) {
                tabNav.classList.remove('expanded');
                toggleBtn.classList.add('collapsed');
                toggleBtn.innerHTML = '<span>üìÇ</span><span>Show Navigation Menu</span><span class="arrow">‚ñº</span>';
            } else {
                tabNav.classList.add('expanded');
                toggleBtn.classList.remove('collapsed');
                toggleBtn.innerHTML = '<span>üìÇ</span><span>Hide Navigation Menu</span><span class="arrow">‚ñº</span>';
            }
        }

        function toggleSection(button) {
            if (!button || !button.nextElementSibling) return;
            const content = button.nextElementSibling;
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                button.classList.add('collapsed');
            } else {
                content.classList.add('expanded');
                button.classList.remove('collapsed');
            }
        }

        function copyCode(elementId) {
            const el = document.getElementById(elementId);
            if (!el) return;
            const text = el.value || el.innerText || el.textContent;
            const codeSection = el.closest('.code-section');
            const copyBtn = codeSection?.querySelector('.copy-btn');
            
            navigator.clipboard.writeText(text).then(() => {
                if (copyBtn) {
                    const orig = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<span>‚úÖ</span> Copied!';
                    copyBtn.classList.add('copied');
                    setTimeout(() => { copyBtn.innerHTML = orig; copyBtn.classList.remove('copied'); }, 2000);
                }
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
            });
        }

        // ============================================================
        // MARKDOWN LOADING (enhanced to create runnable code blocks)
        // ============================================================
        async function loadTabContent(tabName) {
            const config = TAB_CONFIG[tabName];
            if (!config) return;
            const tabElement = document.getElementById(tabName);
            const loadingElement = document.getElementById(`loading-${tabName}`);
            
            try {
                if (loadingElement) loadingElement.style.display = 'flex';
                const response = await fetch(config.file);
                if (!response.ok) throw new Error(`Failed to load ${config.file}`);
                const markdown = await response.text();
                const sections = parseMarkdownHierarchical(markdown);
                const renderedSections = renderHierarchicalSections(sections);
                if (tabElement) {
                    const header = tabElement.querySelector('.section-header').outerHTML;
                    tabElement.innerHTML = header + renderedSections;
                }
                tabElement.dataset.loaded = 'true';
            } catch (error) {
                console.error('Error loading tab:', error);
                if (tabElement) {
                    const header = tabElement.querySelector('.section-header').outerHTML;
                    tabElement.innerHTML = header + `
                        <div class="content-text" style="color: #dc2626; border-left-color: #dc2626;">
                            <strong>Error loading content:</strong><br>
                            Could not load ${config.file}. Please ensure the file exists.
                        </div>`;
                }
            } finally {
                if (loadingElement) loadingElement.style.display = 'none';
            }
        }

        function parseMarkdownHierarchical(markdown) {
            const sections = [];
            const lines = markdown.split('\n');
            let currentSection = null;
            let currentContent = [];
            for (let line of lines) {
                const headerMatch = line.match(/^(#{2,4})\s+(.+)$/);
                if (headerMatch) {
                    if (currentSection) {
                        currentSection.content = currentContent.join('\n').trim();
                        sections.push(currentSection);
                    }
                    currentSection = {
                        level: headerMatch[1].length,
                        title: headerMatch[2].trim(),
                        content: '',
                        id: `section_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
                    };
                    currentContent = [];
                } else {
                    currentContent.push(line);
                }
            }
            if (currentSection) {
                currentSection.content = currentContent.join('\n').trim();
                sections.push(currentSection);
            }
            return sections;
        }

        function renderHierarchicalSections(sections) {
            let html = '';
            let openContainers = [];
            for (let i = 0; i < sections.length; i++) {
                const section = sections[i];
                const nextSection = sections[i + 1];
                if (nextSection && nextSection.level <= section.level) {
                    while (openContainers.length > 0 && openContainers[openContainers.length - 1].level >= nextSection.level) {
                        openContainers.pop();
                        html += '</div></div>';
                    }
                }
                let containerClass = 'collapsible-section';
                if (section.level === 3) containerClass += ' subsection';
                else if (section.level === 4) containerClass += ' sub-subsection';
                
                const processedContent = renderSectionContent(section.content, section.level);
                html += `
                    <div class="${containerClass}">
                        <button class="section-toggle level-${section.level} collapsed" onclick="toggleSection(this)">
                            ${getSectionIcon(section.level)} ${section.title}
                        </button>
                        <div class="section-content level-${section.level}">
                            <div class="content-text level-${section.level}">
                                ${processedContent}
                            </div>`;
                openContainers.push({ level: section.level, id: section.id });
                if (!nextSection || nextSection.level <= section.level) {
                    while (openContainers.length > 0) {
                        openContainers.pop();
                        html += '</div></div>';
                    }
                }
            }
            return html;
        }

        function getSectionIcon(level) {
            return { 2: 'üìÅ', 3: 'üìÇ', 4: 'üìÑ' }[level] || 'üìã';
        }

        // Global counter for unique IDs
        let codeBlockCounter = 0;

        function renderSectionContent(content, level) {
            const codeBlocks = [];
            let processedContent = content;

            // Extract code blocks ‚Äî NOW creates runnable blocks
            processedContent = processedContent.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, language, code) => {
                codeBlockCounter++;
                const codeId = `dyncode_${codeBlockCounter}`;
                const outputId = `dynout_${codeBlockCounter}`;
                codeBlocks.push({ id: codeId, outputId: outputId, language: language || 'python', code: code.trim() });
                return `__CODE_BLOCK_${codeBlocks.length - 1}__`;
            });

            // Escape HTML
            processedContent = processedContent
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');

            // Process tables
            processedContent = processMarkdownTables(processedContent);

            // Process markdown
            processedContent = processedContent
                .replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" style="max-width:100%;height:auto;border-radius:8px;margin:15px 0;">')
                .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" style="color:#0066cc;text-decoration:underline;">$1</a>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code style="background:rgba(0,102,204,0.1);padding:2px 4px;border-radius:3px;">$1</code>')
                .replace(/^\- (.+)$/gm, '<li>$1</li>')
                .replace(/^\d+\.\s(.+)$/gm, '<li>$1</li>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/^(.+)$/gm, '<p>$1</p>');

            processedContent = processedContent.replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>');

            // Replace code blocks with RUNNABLE blocks
            codeBlocks.forEach((block, idx) => {
                const isPython = ['python', 'py', ''].includes(block.language);
                const escapedCode = block.code
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;');

                const runButton = isPython ? 
                    `<button class="run-btn" onclick="runCode('${block.id}', '${block.outputId}')" ${!pyodideReady ? 'disabled' : ''}><span>‚ñ∂</span> Run</button>` : '';

                const outputSection = isPython ? `
                    <div class="output-section" id="${block.outputId}-section" style="display:none;">
                        <div class="output-header">
                            <span>üì§ Output</span>
                            <button class="clear-btn" onclick="clearOutput('${block.outputId}')"><span>üóë</span> Clear</button>
                        </div>
                        <div class="output-content" id="${block.outputId}"></div>
                    </div>` : '';

                const codeHtml = `
                    <div class="code-section">
                        <div class="code-header">
                            <div class="code-title"><span>üíª</span> ${block.language.toUpperCase()} Code</div>
                            <div class="code-actions">
                                <button class="copy-btn" onclick="copyCode('${block.id}')"><span>üìã</span> Copy</button>
                                ${runButton}
                            </div>
                        </div>
                        <div class="code-container">
                            ${isPython ? 
                                `<textarea class="code-editor" id="${block.id}" spellcheck="false">${block.code}</textarea>` :
                                `<div class="code-content" id="${block.id}">${escapedCode}</div>`
                            }
                        </div>
                        ${outputSection}
                    </div>`;
                processedContent = processedContent.replace(`__CODE_BLOCK_${idx}__`, codeHtml);
            });

            return processedContent;
        }

        function processMarkdownTables(content) {
            const lines = content.split('\n');
            const processedLines = [];
            let inTable = false;
            let tableLines = [];
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line.includes('|') && line.length > 0) {
                    if (!inTable) { inTable = true; tableLines = []; }
                    tableLines.push(line);
                } else {
                    if (inTable && tableLines.length > 0) {
                        processedLines.push(convertMarkdownTableToHtml(tableLines));
                        inTable = false; tableLines = [];
                    }
                    processedLines.push(line);
                }
            }
            if (inTable && tableLines.length > 0) processedLines.push(convertMarkdownTableToHtml(tableLines));
            return processedLines.join('\n');
        }

        function convertMarkdownTableToHtml(tableLines) {
            if (tableLines.length < 2) return tableLines.join('\n');
            const dataLines = tableLines.filter(line => !line.match(/^[\|\-\:\s]+$/));
            if (dataLines.length === 0) return '';
            let html = '<div class="table-container"><table class="markdown-table">';
            const headerCells = parseTableRow(dataLines[0]);
            if (headerCells.length > 0) {
                html += '<thead><tr>';
                headerCells.forEach(cell => html += `<th>${cell.trim()}</th>`);
                html += '</tr></thead>';
            }
            if (dataLines.length > 1) {
                html += '<tbody>';
                for (let i = 1; i < dataLines.length; i++) {
                    const cells = parseTableRow(dataLines[i]);
                    if (cells.length > 0) {
                        html += '<tr>';
                        cells.forEach(cell => html += `<td>${cell.trim()}</td>`);
                        html += '</tr>';
                    }
                }
                html += '</tbody>';
            }
            html += '</table></div>';
            return html;
        }

        function parseTableRow(line) {
            return line.replace(/^\||\|$/g, '').split('|').map(c => c.trim()).filter(c => c.length > 0);
        }

        // ============================================================
        // INITIALIZATION
        // ============================================================
        document.addEventListener('DOMContentLoaded', async function() {
            await loadTabConfiguration();

            // Collapse nav by default
            document.getElementById('tabNavigation')?.classList.remove('expanded');
            document.getElementById('tabToggleBtn')?.classList.add('collapsed');

            // Collapse all sections
            document.querySelectorAll('.section-content').forEach(s => s.classList.remove('expanded'));
            document.querySelectorAll('.section-toggle').forEach(b => b.classList.add('collapsed'));

            // Load Pyodide
            initPyodide();
        });

        // Handle Tab key in textareas
        document.addEventListener('keydown', function(e) {
            if (e.target.classList.contains('code-editor') && e.key === 'Tab') {
                e.preventDefault();
                const start = e.target.selectionStart;
                const end = e.target.selectionEnd;
                e.target.value = e.target.value.substring(0, start) + '    ' + e.target.value.substring(end);
                e.target.selectionStart = e.target.selectionEnd = start + 4;
            }
            // Ctrl/Cmd+Enter to run
            if (e.target.classList.contains('code-editor') && e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                const codeSection = e.target.closest('.code-section');
                const runBtn = codeSection?.querySelector('.run-btn');
                if (runBtn) runBtn.click();
            }
        });
    </script>
</body>
</html>
